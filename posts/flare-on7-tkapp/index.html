<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Flare-On 7 — 05 TKApp - explained.re</title><meta name=Description content><meta property="og:title" content="Flare-On 7 — 05 TKApp"><meta property="og:description" content="Challenge Description  Now you can play Flare-On on your watch! As long as you still have an arm left to put a watch on, or emulate the watch&rsquo;s operating system with sophisticated developer tools.   In this one, we get a .tpk file which is a Tizen OS application that&rsquo;s used in smartwatches. Let&rsquo;s extract the files from this archive to see what we&rsquo;re dealing with.
$ unzip TKApp."><meta property="og:type" content="article"><meta property="og:url" content="https://explained.re/posts/flare-on7-tkapp/"><meta property="og:image" content="https://explained.re/images/explained_dark.png"><meta property="article:published_time" content="2020-10-23T21:29:45+03:00"><meta property="article:modified_time" content="2020-10-23T21:29:45+03:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://explained.re/images/explained_dark.png"><meta name=twitter:title content="Flare-On 7 — 05 TKApp"><meta name=twitter:description content="Challenge Description  Now you can play Flare-On on your watch! As long as you still have an arm left to put a watch on, or emulate the watch&rsquo;s operating system with sophisticated developer tools.   In this one, we get a .tpk file which is a Tizen OS application that&rsquo;s used in smartwatches. Let&rsquo;s extract the files from this archive to see what we&rsquo;re dealing with.
$ unzip TKApp."><meta name=application-name content="explained.re"><meta name=apple-mobile-web-app-title content="explained.re"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://explained.re/posts/flare-on7-tkapp/><link rel=prev href=https://explained.re/posts/flare-on7-report/><link rel=next href=https://explained.re/posts/flare-on7-codeit/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Flare-On 7 — 05 TKApp","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/explained.re\/posts\/flare-on7-tkapp\/"},"genre":"posts","keywords":"flare-on","wordcount":821,"url":"https:\/\/explained.re\/posts\/flare-on7-tkapp\/","datePublished":"2020-10-23T21:29:45+03:00","dateModified":"2020-10-23T21:29:45+03:00","publisher":{"@type":"Organization","name":"explained.re"},"author":{"@type":"Person","name":"explained.re"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('dark'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'dark'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=explained.re><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/explained.svg data-srcset="/images/explained.svg, /images/explained.svg 1.5x, /images/explained.svg 2x" data-sizes=auto alt=/images/explained.svg title=/images/explained.svg></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about/>About </a><a class=menu-item href=https://github.com/explainedre/website title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=explained.re><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/explained.svg data-srcset="/images/explained.svg, /images/explained.svg 1.5x, /images/explained.svg 2x" data-sizes=auto alt=/images/explained.svg title=/images/explained.svg></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/>Posts</a><a class=menu-item href=/tags/>Tags</a><a class=menu-item href=/categories/>Categories</a><a class=menu-item href=/about/>About</a><a class=menu-item href=https://github.com/explainedre/website title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><article class="page single"><h1 class="single-title animated flipInX">Flare-On 7 — 05 TKApp</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>explained.re</a></span>&nbsp;<span class=post-category>included in <a href=/categories/write-up/><i class="far fa-folder fa-fw"></i>write-up</a>&nbsp;<a href=/categories/ctf/><i class="far fa-folder fa-fw"></i>ctf</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2020-10-23>2020-10-23</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;821 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;4 minutes&nbsp;</div></div><div class=content id=content><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw"></i>Challenge Description<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>Now you can play Flare-On on your watch! As long as you still have an arm left to put a watch on, or emulate the watch&rsquo;s operating system with sophisticated developer tools.</div></div></div><p>In this one, we get a <code>.tpk</code> file which is a <em>Tizen OS</em> application that&rsquo;s used in smartwatches. Let&rsquo;s extract the files from this archive to see what we&rsquo;re dealing with.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ unzip TKApp.tpk
$ ls
Message.txt      TKApp.tpk             bin  res     signature1.xml
TKApp.deps.json  author-signature.xml  lib  shared  tizen-manifest.xml
</code></pre></div><p>Looks like we have an application manifest, so let&rsquo;s look at it first.</p><div class=highlight><pre class=chroma><code class=language-xml data-lang=xml><span class=c>&lt;!-- tizen-manifest.xml --&gt;</span>
<span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span class=nt>&lt;manifest</span> <span class=na>package=</span><span class=s>&#34;com.flare-on.TKApp&#34;</span> <span class=na>version=</span><span class=s>&#34;1.0.0&#34;</span> <span class=na>api-version=</span><span class=s>&#34;5.5&#34;</span> <span class=na>xmlns=</span><span class=s>&#34;http://tizen.org/ns/packages&#34;</span><span class=nt>&gt;</span>
    <span class=nt>&lt;author</span> <span class=na>href=</span><span class=s>&#34;http://www.flare-on.com&#34;</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;profile</span> <span class=na>name=</span><span class=s>&#34;wearable&#34;</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;ui-application</span> <span class=na>appid=</span><span class=s>&#34;com.flare-on.TKApp&#34;</span> <span class=na>exec=</span><span class=s>&#34;TKApp.dll&#34;</span> <span class=na>multiple=</span><span class=s>&#34;false&#34;</span> <span class=na>nodisplay=</span><span class=s>&#34;false&#34;</span> <span class=na>taskmanage=</span><span class=s>&#34;true&#34;</span> <span class=na>api-version=</span><span class=s>&#34;6&#34;</span> <span class=na>type=</span><span class=s>&#34;dotnet&#34;</span> <span class=na>launch_mode=</span><span class=s>&#34;single&#34;</span><span class=nt>&gt;</span>
        <span class=nt>&lt;label&gt;</span>TKApp<span class=nt>&lt;/label&gt;</span>
        <span class=nt>&lt;icon&gt;</span>TKApp.png<span class=nt>&lt;/icon&gt;</span>
        <span class=nt>&lt;metadata</span> <span class=na>key=</span><span class=s>&#34;http://tizen.org/metadata/prefer_dotnet_aot&#34;</span> <span class=na>value=</span><span class=s>&#34;true&#34;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;metadata</span> <span class=na>key=</span><span class=s>&#34;its&#34;</span> <span class=na>value=</span><span class=s>&#34;magic&#34;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;splash-screens</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;/ui-application&gt;</span>
    <span class=nt>&lt;shortcut-list</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;privileges&gt;</span>
        <span class=nt>&lt;privilege&gt;</span>http://tizen.org/privilege/location<span class=nt>&lt;/privilege&gt;</span>
        <span class=nt>&lt;privilege&gt;</span>http://tizen.org/privilege/healthinfo<span class=nt>&lt;/privilege&gt;</span>
    <span class=nt>&lt;/privileges&gt;</span>
    <span class=nt>&lt;dependencies</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;provides-appdefined-privileges</span> <span class=nt>/&gt;</span>
<span class=nt>&lt;/manifest&gt;</span>
</code></pre></div><p>We have here the main UI application which has the ID <code>com.flare-on.TKApp</code>, and it uses the executable file <code>TKApp.dll</code>, so we can jump straight into it.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ file bin/TKApp.dll                                                                                            <span class=m>130</span> ↵
bin/TKApp.dll: PE32 executable <span class=o>(</span>console<span class=o>)</span> Intel <span class=m>80386</span> Mono/.Net assembly, <span class=k>for</span> MS Windows
</code></pre></div><p>Since this is a .net executable, we&rsquo;ll fire up <em><a href=https://github.com/dnSpy/dnSpy/releases target=_blank rel="noopener noreffer">DNSpy</a>.</em> We can start by hitting <code>Ctrl+Shift+K</code> for searching, and search for &ldquo;flag&rdquo;. We do get a label with that name in <code>TKApp.UnlockPage</code>. In the <code>UnlockPage</code> class, we see a function called <code>IsPasswordCorrect</code>, let&rsquo;s get this password.</p><div class=highlight><pre class=chroma><code class=language-csharp data-lang=csharp><span class=k>private</span> <span class=kt>bool</span> <span class=n>IsPasswordCorrect</span><span class=p>(</span><span class=kt>string</span> <span class=n>password</span><span class=p>)</span>
<span class=p>{</span>
	<span class=k>return</span> <span class=n>password</span> <span class=p>==</span> <span class=n>Util</span><span class=p>.</span><span class=n>Decode</span><span class=p>(</span><span class=n>TKData</span><span class=p>.</span><span class=n>Password</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><p>We&rsquo;ll take the <code>TKDate.Password</code> and the <code>Decode</code> functions and run it in Python.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>password</span> <span class=o>=</span> <span class=p>[</span><span class=mi>62</span><span class=p>,</span> <span class=mi>38</span><span class=p>,</span> <span class=mi>63</span><span class=p>,</span> <span class=mi>63</span><span class=p>,</span> <span class=mi>54</span><span class=p>,</span> <span class=mi>39</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>39</span><span class=p>]</span>
<span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>chr</span><span class=p>(</span><span class=n>c</span> <span class=o>^</span> <span class=mi>83</span><span class=p>)</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>password</span><span class=p>])</span>
<span class=c1># Result:</span>
<span class=c1># &#39;mullethat&#39;</span>
</code></pre></div><p>The correct password is <code>mullethat</code>. Now let&rsquo;s see if anyone&rsquo;s using this value. Right-clicking and hitting <em>Analyze</em> on <code>IsPasswordCorrect</code>, then looking at the <em>Used by</em> list, we see that <code>OnLoginButtonClicked</code> is using this function.</p><div class=highlight><pre class=chroma><code class=language-csharp data-lang=csharp><span class=k>private</span> <span class=k>async</span> <span class=k>void</span> <span class=n>OnLoginButtonClicked</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
		<span class=p>{</span>
			<span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=n>IsPasswordCorrect</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=n>passwordEntry</span><span class=p>.</span><span class=n>Text</span><span class=p>))</span>
			<span class=p>{</span>
				<span class=n>App</span><span class=p>.</span><span class=n>IsLoggedIn</span> <span class=p>=</span> <span class=k>true</span><span class=p>;</span>
				<span class=n>App</span><span class=p>.</span><span class=n>Password</span> <span class=p>=</span> <span class=k>this</span><span class=p>.</span><span class=n>passwordEntry</span><span class=p>.</span><span class=n>Text</span><span class=p>;</span>
				<span class=k>base</span><span class=p>.</span><span class=n>Navigation</span><span class=p>.</span><span class=n>InsertPageBefore</span><span class=p>(</span><span class=k>new</span> <span class=n>MainPage</span><span class=p>(),</span> <span class=k>this</span><span class=p>);</span>
				<span class=k>await</span> <span class=k>base</span><span class=p>.</span><span class=n>Navigation</span><span class=p>.</span><span class=n>PopAsync</span><span class=p>();</span>
			<span class=p>}</span>
			<span class=k>else</span>
			<span class=p>{</span>
				<span class=n>Toast</span><span class=p>.</span><span class=n>DisplayText</span><span class=p>(</span><span class=s>&#34;Unlock failed!&#34;</span><span class=p>,</span> <span class=m>2000</span><span class=p>);</span>
				<span class=k>this</span><span class=p>.</span><span class=n>passwordEntry</span><span class=p>.</span><span class=n>Text</span> <span class=p>=</span> <span class=kt>string</span><span class=p>.</span><span class=n>Empty</span><span class=p>;</span>
			<span class=p>}</span>
		<span class=p>}</span>
</code></pre></div><p>After checking if the password is correct, it&rsquo;s stored in the <code>App.Password</code> field. We&rsquo;ll use <em>Analyze</em> again to see who&rsquo;s accessing this and this will bring us to <code>GetImage</code>. This function uses decode some data using our password (among other things) and sets this as the image of the application. This can potentially be the image of our flag so let&rsquo;s execute this in Python as well. We&rsquo;ll need to get a few elements for that:</p><ol><li><p><code>Password</code> - already got that.</p></li><li><p><code>Desc</code> - by analyzing and looking at who&rsquo;s setting this value, we get to <code>GalleryPage.IndexPage_CurrentPageChanged</code> which sets this field to the value of the image description of the file <code>gallery/05.jpg</code>. It&rsquo;s easy to get this using:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ exiftool res/gallery/05.jpg <span class=p>|</span> grep -i description                                                                                                                                        <span class=m>1</span> ↵
Image Description               : **water**
</code></pre></div></li><li><p><code>Note</code> - once again, we&rsquo;ll analyze until we get to the one who sets this value, which is <code>TodoPage.SetupList</code></p><div class=highlight><pre class=chroma><code class=language-csharp data-lang=csharp><span class=k>private</span> <span class=k>void</span> <span class=n>SetupList</span><span class=p>()</span>
        <span class=p>{</span>
            <span class=n>List</span><span class=p>&lt;</span><span class=n>TodoPage</span><span class=p>.</span><span class=n>Todo</span><span class=p>&gt;</span> <span class=n>list</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>TodoPage</span><span class=p>.</span><span class=n>Todo</span><span class=p>&gt;();</span>
            <span class=k>if</span> <span class=p>(!</span><span class=k>this</span><span class=p>.</span><span class=n>isHome</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>list</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=k>new</span> <span class=n>TodoPage</span><span class=p>.</span><span class=n>Todo</span><span class=p>(</span><span class=s>&#34;go home&#34;</span><span class=p>,</span> <span class=s>&#34;and enable GPS&#34;</span><span class=p>,</span> <span class=k>false</span><span class=p>));</span>
            <span class=p>}</span>
            <span class=k>else</span>
            <span class=p>{</span>
                <span class=n>TodoPage</span><span class=p>.</span><span class=n>Todo</span><span class=p>[]</span> <span class=n>collection</span> <span class=p>=</span> <span class=k>new</span> <span class=n>TodoPage</span><span class=p>.</span><span class=n>Todo</span><span class=p>[]</span>
                <span class=p>{</span>
                    <span class=k>new</span> <span class=n>TodoPage</span><span class=p>.</span><span class=n>Todo</span><span class=p>(</span><span class=s>&#34;hang out in tiger cage&#34;</span><span class=p>,</span> <span class=s>&#34;and survive&#34;</span><span class=p>,</span> <span class=k>true</span><span class=p>),</span>
                    <span class=k>new</span> <span class=n>TodoPage</span><span class=p>.</span><span class=n>Todo</span><span class=p>(</span><span class=s>&#34;unload Walmart truck&#34;</span><span class=p>,</span> <span class=s>&#34;keep steaks for dinner&#34;</span><span class=p>,</span> <span class=k>false</span><span class=p>),</span>
                    <span class=k>new</span> <span class=n>TodoPage</span><span class=p>.</span><span class=n>Todo</span><span class=p>(</span><span class=s>&#34;yell at staff&#34;</span><span class=p>,</span> <span class=s>&#34;maybe fire someone&#34;</span><span class=p>,</span> <span class=k>false</span><span class=p>),</span>
                    <span class=k>new</span> <span class=n>TodoPage</span><span class=p>.</span><span class=n>Todo</span><span class=p>(</span><span class=s>&#34;say no to drugs&#34;</span><span class=p>,</span> <span class=s>&#34;unless it&#39;s a drinking day&#34;</span><span class=p>,</span> <span class=k>false</span><span class=p>),</span>
                    <span class=k>new</span> <span class=n>TodoPage</span><span class=p>.</span><span class=n>Todo</span><span class=p>(</span><span class=s>&#34;listen to some tunes&#34;</span><span class=p>,</span> <span class=s>&#34;https://youtu.be/kTmZnQOfAF8&#34;</span><span class=p>,</span> <span class=k>true</span><span class=p>)</span>
                <span class=p>};</span>
                <span class=n>list</span><span class=p>.</span><span class=n>AddRange</span><span class=p>(</span><span class=n>collection</span><span class=p>);</span>
            <span class=p>}</span>
            <span class=n>List</span><span class=p>&lt;</span><span class=n>TodoPage</span><span class=p>.</span><span class=n>Todo</span><span class=p>&gt;</span> <span class=n>list2</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>TodoPage</span><span class=p>.</span><span class=n>Todo</span><span class=p>&gt;();</span>
            <span class=k>foreach</span> <span class=p>(</span><span class=n>TodoPage</span><span class=p>.</span><span class=n>Todo</span> <span class=n>todo</span> <span class=k>in</span> <span class=n>list</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=k>if</span> <span class=p>(!</span><span class=n>todo</span><span class=p>.</span><span class=n>Done</span><span class=p>)</span>
                <span class=p>{</span>
                    <span class=n>list2</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>todo</span><span class=p>);</span>
                <span class=p>}</span>
            <span class=p>}</span>
            <span class=k>this</span><span class=p>.</span><span class=n>mylist</span><span class=p>.</span><span class=n>ItemsSource</span> <span class=p>=</span> <span class=n>list2</span><span class=p>;</span>
            <span class=p>**</span><span class=n>App</span><span class=p>.</span><span class=n>Note</span> <span class=p>=</span> <span class=n>list2</span><span class=p>[</span><span class=m>0</span><span class=p>].</span><span class=n>Note</span><span class=p>;**</span>
        <span class=p>}</span>
</code></pre></div><p>From here we need the note of the first item which is not done yet, and we get <code>keep steaks for dinner</code>.</p></li><li><p><code>Step</code> - in a similar way, we get to <code>MainPage.PedDataUpdate</code> who sets it in the following line:</p><div class=highlight><pre class=chroma><code class=language-csharp data-lang=csharp><span class=n>App</span><span class=p>.</span><span class=n>Step</span> <span class=p>=</span> <span class=n>Application</span><span class=p>.</span><span class=n>Current</span><span class=p>.</span><span class=n>ApplicationInfo</span><span class=p>.</span><span class=n>Metadata</span><span class=p>[</span><span class=s>&#34;its&#34;</span><span class=p>];</span>
</code></pre></div><p>The <code>ApplicationInfo</code> is set in the manifest xml we saw at the beginning:</p><div class=highlight><pre class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;metadata</span> <span class=na>key=</span><span class=s>&#34;its&#34;</span> <span class=na>value=</span><span class=s>&#34;**magic**&#34;</span> <span class=nt>/&gt;</span>
</code></pre></div><p>We get <code>magic</code>.</p></li><li><p><code>Runtime.dll</code> - the program accesses it using the resource manager, we can simply save this file from the Resources dialog in <em>DNSpy</em> by right-clicking and hitting <em>save.</em></p></li></ol><a class=lightgallery href=/posts/flare-on7-tkapp/images/image.png title=/posts/flare-on7-tkapp/images/image.png data-thumbnail=/posts/flare-on7-tkapp/images/image.png><img class=lazyload src=/svg/loading.min.svg data-src=images/image.png data-srcset="/posts/flare-on7-tkapp/images/image.png, images/image.png 1.5x, /posts/flare-on7-tkapp/images/image.png 2x" data-sizes=auto alt=/posts/flare-on7-tkapp/images/image.png></a><p>The decoding process contains SHA256 and base64, and if we examine the <code>Util.GetString</code> function we see it&rsquo;s Rijndael (AES).</p><p>Once we got all this, we can write the algorithm ourselves.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>malduck</span> <span class=kn>import</span> <span class=n>sha256</span><span class=p>,</span> <span class=n>aes</span><span class=p>,</span> <span class=n>base64</span>

<span class=n>password</span> <span class=o>=</span> <span class=s2>&#34;mullethat&#34;</span>
<span class=n>desc</span> <span class=o>=</span> <span class=s2>&#34;water&#34;</span>
<span class=n>note</span> <span class=o>=</span> <span class=s2>&#34;keep steaks for dinner&#34;</span>
<span class=n>step</span> <span class=o>=</span> <span class=s2>&#34;magic&#34;</span>

<span class=n>text</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span>
				<span class=n>desc</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span>
				<span class=n>password</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span>
				<span class=n>password</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>17</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>18</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>16</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>11</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>13</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>12</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>15</span><span class=p>],</span>
				<span class=n>step</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span>
				<span class=n>password</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span>
				<span class=n>desc</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span>
				<span class=n>password</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span>
				<span class=n>password</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span>
				<span class=n>password</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>18</span><span class=p>],</span>
				<span class=n>step</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span>
				<span class=n>password</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span>
				<span class=n>desc</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
				<span class=n>desc</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>15</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span>
				<span class=n>desc</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span>
				<span class=n>desc</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span>
				<span class=n>step</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>13</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>18</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>18</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span>
				<span class=n>password</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
				<span class=n>password</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
				<span class=n>password</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span>
				<span class=n>note</span><span class=p>[</span><span class=mi>11</span><span class=p>],</span>
				<span class=n>password</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span>
				<span class=n>password</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span>
				<span class=n>desc</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span>
				<span class=n>desc</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span>
			<span class=p>])</span>

<span class=n>key</span> <span class=o>=</span> <span class=n>sha256</span><span class=p>(</span><span class=n>text</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>   <span class=c1># rijndaelManaged.Key</span>

<span class=n>iv</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;NoSaltOfTheEarth&#34;</span>  <span class=c1># rijndaelManaged.IV</span>

<span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;Runtime.dll&#34;</span> <span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
    <span class=c1># decrypt</span>
    <span class=n>plaintext</span> <span class=o>=</span> <span class=n>aes</span><span class=o>.</span><span class=n>cbc</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span>

<span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;decrypted_Runtime.jpeg&#34;</span><span class=p>,</span> <span class=s2>&#34;wb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span> <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>base64</span><span class=p>(</span><span class=n>plaintext</span><span class=p>))</span>
</code></pre></div><p>Running this and opening the image we get the flag.</p><a class=lightgallery href=/posts/flare-on7-tkapp/images/decrypted_Runtime_base64_decoded.jpeg title=/posts/flare-on7-tkapp/images/decrypted_Runtime_base64_decoded.jpeg data-thumbnail=/posts/flare-on7-tkapp/images/decrypted_Runtime_base64_decoded.jpeg><img class=lazyload src=/svg/loading.min.svg data-src=images/decrypted_Runtime_base64_decoded.jpeg data-srcset="/posts/flare-on7-tkapp/images/decrypted_Runtime_base64_decoded.jpeg, images/decrypted_Runtime_base64_decoded.jpeg 1.5x, /posts/flare-on7-tkapp/images/decrypted_Runtime_base64_decoded.jpeg 2x" data-sizes=auto alt=/posts/flare-on7-tkapp/images/decrypted_Runtime_base64_decoded.jpeg></a><p>Flag: <a href=mailto:n3ver_go1ng_to_recov3r@flare-on.com rel><code>n3ver_go1ng_to_recov3r@flare-on.com</code></a>.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2020-10-23</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/flare-on/>flare-on</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/flare-on7-report/ class=prev rel=prev title="Flare-On 7 — 04 Report"><i class="fas fa-angle-left fa-fw"></i>Flare-On 7 — 04 Report</a>
<a href=/posts/flare-on7-codeit/ class=next rel=next title="Flare-On 7 — 06 Codeit">Flare-On 7 — 06 Codeit<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.78.1">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":60},"comment":{},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true}};</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-Z0NYXY577C');</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-Z0NYXY577C" async></script></body></html>