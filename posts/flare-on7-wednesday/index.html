<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Flare-On 7 — 03 Wednesday - explained.re</title><meta name="Description" content=""><meta property="og:title" content="Flare-On 7 — 03 Wednesday" />
<meta property="og:description" content="Challenge Description  Be the wednesday. Unlike challenge 1, you probably won&rsquo;t be able to beat this game the old fashioned way. Read the README.txt file, it is very important.   Usually, when the challenge author tells you that the README.txt is very important, it&rsquo;s a great idea to start the challenge by reading it.
██╗ ██╗███████╗██████╗ ███╗ ██╗███████╗███████╗██████╗ █████╗ ██╗ ██╗ ██║ ██║██╔════╝██╔══██╗████╗ ██║██╔════╝██╔════╝██╔══██╗██╔══██╗╚██╗ ██╔╝ ██║ █╗ ██║█████╗ ██║ ██║██╔██╗ ██║█████╗ ███████╗██║ ██║███████║ ╚████╔╝ ██║███╗██║██╔══╝ ██║ ██║██║╚██╗██║██╔══╝ ╚════██║██║ ██║██╔══██║ ╚██╔╝ ╚███╔███╔╝███████╗██████╔╝██║ ╚████║███████╗███████║██████╔╝██║ ██║ ██║ ╚══╝╚══╝ ╚══════╝╚═════╝ ╚═╝ ╚═══╝╚══════╝╚══════╝╚═════╝ ╚═╝ ╚═╝ ╚═╝ --- BE THE WEDNESDAY --- S M T DUDE T F S --- Enable accelerated graphics in VM --- --- Attach sound card device to VM --- --- Only reverse mydude." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://explained.re/posts/flare-on7-wednesday/" />
<meta property="og:image" content="https://explained.re/images/explained.svg"/>
<meta property="article:published_time" content="2020-10-23T21:29:43+03:00" />
<meta property="article:modified_time" content="2020-10-23T21:29:43+03:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://explained.re/images/explained.svg"/>

<meta name="twitter:title" content="Flare-On 7 — 03 Wednesday"/>
<meta name="twitter:description" content="Challenge Description  Be the wednesday. Unlike challenge 1, you probably won&rsquo;t be able to beat this game the old fashioned way. Read the README.txt file, it is very important.   Usually, when the challenge author tells you that the README.txt is very important, it&rsquo;s a great idea to start the challenge by reading it.
██╗ ██╗███████╗██████╗ ███╗ ██╗███████╗███████╗██████╗ █████╗ ██╗ ██╗ ██║ ██║██╔════╝██╔══██╗████╗ ██║██╔════╝██╔════╝██╔══██╗██╔══██╗╚██╗ ██╔╝ ██║ █╗ ██║█████╗ ██║ ██║██╔██╗ ██║█████╗ ███████╗██║ ██║███████║ ╚████╔╝ ██║███╗██║██╔══╝ ██║ ██║██║╚██╗██║██╔══╝ ╚════██║██║ ██║██╔══██║ ╚██╔╝ ╚███╔███╔╝███████╗██████╔╝██║ ╚████║███████╗███████║██████╔╝██║ ██║ ██║ ╚══╝╚══╝ ╚══════╝╚═════╝ ╚═╝ ╚═══╝╚══════╝╚══════╝╚═════╝ ╚═╝ ╚═╝ ╚═╝ --- BE THE WEDNESDAY --- S M T DUDE T F S --- Enable accelerated graphics in VM --- --- Attach sound card device to VM --- --- Only reverse mydude."/>
<meta name="application-name" content="explained.re">
<meta name="apple-mobile-web-app-title" content="explained.re"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://explained.re/posts/flare-on7-wednesday/" /><link rel="prev" href="https://explained.re/posts/flare-on7-garbage/" /><link rel="next" href="https://explained.re/posts/flare-on7-report/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Flare-On 7 — 03 Wednesday",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/explained.re\/posts\/flare-on7-wednesday\/"
        },"genre": "posts","keywords": "flare-on","wordcount":  1411 ,
        "url": "https:\/\/explained.re\/posts\/flare-on7-wednesday\/","datePublished": "2020-10-23T21:29:43+03:00","dateModified": "2020-10-23T21:29:43+03:00","publisher": {
            "@type": "Organization",
            "name": "explained.re"},"author": {
                "@type": "Person",
                "name": "explained.re"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="explained.re"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/explained.svg"
        data-srcset="/images/explained.svg, /images/explained.svg 1.5x, /images/explained.svg 2x"
        data-sizes="auto"
        alt="/images/explained.svg"
        title="/images/explained.svg" /></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/explainedre/website" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="explained.re"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/explained.svg"
        data-srcset="/images/explained.svg, /images/explained.svg 1.5x, /images/explained.svg 2x"
        data-sizes="auto"
        alt="/images/explained.svg"
        title="/images/explained.svg" /></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/explainedre/website" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><article class="page single"><h1 class="single-title animated flipInX">Flare-On 7 — 03 Wednesday</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>explained.re</a></span>&nbsp;<span class="post-category">included in <a href="/categories/write-up/"><i class="far fa-folder fa-fw"></i>write-up</a>&nbsp;<a href="/categories/ctf/"><i class="far fa-folder fa-fw"></i>ctf</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-10-23">2020-10-23</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1411 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;7 minutes&nbsp;</div>
        </div><div class="content" id="content"><div class="details admonition info open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-info-circle fa-fw"></i>Challenge Description<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">Be the wednesday. Unlike challenge 1, you probably won&rsquo;t be able to beat this game the old fashioned way. Read the README.txt file, it is very important.</div>
        </div>
    </div>
<p>Usually, when the challenge author tells you that the <code>README.txt</code> is very important, it&rsquo;s a great idea to start the challenge by reading it.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="err">██╗</span>    <span class="err">██╗███████╗██████╗</span> <span class="err">███╗</span>   <span class="err">██╗███████╗███████╗██████╗</span>  <span class="err">█████╗</span> <span class="err">██╗</span>   <span class="err">██╗</span>
<span class="err">██║</span>    <span class="err">██║██╔════╝██╔══██╗████╗</span>  <span class="err">██║██╔════╝██╔════╝██╔══██╗██╔══██╗╚██╗</span> <span class="err">██╔╝</span>
<span class="err">██║</span> <span class="err">█╗</span> <span class="err">██║█████╗</span>  <span class="err">██║</span>  <span class="err">██║██╔██╗</span> <span class="err">██║█████╗</span>  <span class="err">███████╗██║</span>  <span class="err">██║███████║</span> <span class="err">╚████╔╝</span> 
<span class="err">██║███╗██║██╔══╝</span>  <span class="err">██║</span>  <span class="err">██║██║╚██╗██║██╔══╝</span>  <span class="err">╚════██║██║</span>  <span class="err">██║██╔══██║</span>  <span class="err">╚██╔╝</span>  
<span class="err">╚███╔███╔╝███████╗██████╔╝██║</span> <span class="err">╚████║███████╗███████║██████╔╝██║</span>  <span class="err">██║</span>   <span class="err">██║</span>   
 <span class="err">╚══╝╚══╝</span> <span class="err">╚══════╝╚═════╝</span> <span class="err">╚═╝</span>  <span class="err">╚═══╝╚══════╝╚══════╝╚═════╝</span> <span class="err">╚═╝</span>  <span class="err">╚═╝</span>   <span class="err">╚═╝</span>   

                        <span class="o">---</span> <span class="n">BE</span> <span class="n">THE</span> <span class="n">WEDNESDAY</span> <span class="o">---</span>
                                   <span class="n">S</span>
                                   <span class="n">M</span>
                                   <span class="n">T</span>
                                  <span class="n">DUDE</span>
                                   <span class="n">T</span>
                                   <span class="n">F</span>
                                   <span class="n">S</span>
                <span class="o">---</span> <span class="n">Enable</span> <span class="n">accelerated</span> <span class="n">graphics</span> <span class="ow">in</span> <span class="n">VM</span> <span class="o">---</span>
                  <span class="o">---</span> <span class="n">Attach</span> <span class="n">sound</span> <span class="n">card</span> <span class="n">device</span> <span class="n">to</span> <span class="n">VM</span> <span class="o">---</span>
                    <span class="o">---</span> <span class="n">Only</span> <span class="n">reverse</span> <span class="n">mydude</span><span class="o">.</span><span class="n">exe</span> <span class="o">---</span>
                       <span class="o">---</span> <span class="n">Enjoy</span> <span class="n">it</span> <span class="n">my</span> <span class="n">dudes</span> <span class="o">---</span>
</code></pre></div><p>So we&rsquo;re told to &ldquo;be the wednesday &quot; which seems a bit vague, we see this &ldquo;DUDE&rdquo; in the middle of some letters, and some instructions on how to get the executable running on our machine. Lastly, we have an important instruction - only reverse <code>mydude.exe</code>. This is important since the challenge comes with a lot of files.</p>
<p>Next, we can execute the binary and see what&rsquo;s going in it. It looks like a pretty standard side-scroller game, where we control <em>dude</em> and need to avoid obstacles in order to score points. From playing around for a couple of minutes, we can notice that we should duck when approaching squares containing the letters S/M/T should be and jump when approaching T/F/S. Much like in the form we saw in the challenge&rsquo;s readme. Let&rsquo;s open this game up in a disassembler and see how we can get to the winning screen to get the flag. We&rsquo;ll start with our <code>main</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">__main</span><span class="p">();</span>
  <span class="n">cmdLine</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">argv</span><span class="p">;</span>
  <span class="n">cmdCount</span> <span class="o">=</span> <span class="n">argc</span><span class="p">;</span>
  <span class="n">gEnv</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">envp</span><span class="p">;</span>
  <span class="n">NimMain</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">nim_program_result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>Based on the fact we have a <code>NimMain</code> function, we can understand that this executable was developed in <a href="https://nim-lang.org/" target="_blank" rel="noopener noreffer">Nim</a>. This is useful since as you can see in the binary, all the names from the original source code were saved and we can see those in the binary. This can help us quite a lot when trying to understand the logic of different functions. From <code>NimMain</code> we see a few function calls that eventually get us to the main functionality of the binary - <code>NimMain</code> → <code>NimMainInner</code> → <code>NimMainModule</code>. This function is responsible for initializing the game object and creating the game&rsquo;s main scene, then it finally runs the game and we&rsquo;ll get to the main game loop in <code>run__E9cSjWeb4G6NszYRcpo6sLA_2</code>.</p>
<p>Now we need to have a goal in mind before we continue our reversing process. The option we may come up with at this point are:</p>
<ol>
<li>Find the flag statically / find where the flag is decode or decrypted upon a win, and do that statically</li>
<li>Patch the game in order to win. This can be done in many way, here are two:
<ol>
<li>Reduce a score threshold we need to get to in order to win - make the winning screen pop up after passing one obstacle for example.</li>
<li>Patch the condition in which the game decide if we pass an obstacle or not, to make it always think we passed</li>
</ol>
</li>
</ol>
<p>For option 1, it can be useful to start and look for strings related to our score, so we can locate it in memory. In this case, we couldn&rsquo;t really find those strings the traditional way, so we&rsquo;ll do something else. In our main function <code>run__E9cSjWeb4G6NszYRcpo6sLA_2</code>, we see a lot of call for different update functions. They seem to be invoked in order to update certain elements of the game like location, status, and probably score as well. Stepping through those functions we see <code>update__Arw3f6ryHvqdibU49aaayOg</code> which seems to be creating some score-related strings. Stepping through that as well, we find a very interesting check that seems to show the <code>winScene</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="n">v15</span> <span class="o">==</span> <span class="mh">0x128</span> <span class="p">)</span>
      <span class="n">sceneeq___HC7o4hYar8OQigU09cNyehg</span><span class="p">(</span><span class="n">game__7aozTrKmb7lwLeRmW9a9cs9cQ</span><span class="p">,</span> <span class="n">winScene__eVaCVkG1QBiYVChMxpMGBQ</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre></div><p>It tests whether our score is equal to <code>0x128</code>. Let&rsquo;s patch this so the winning score should be lower, and see if we get the flag. We&rsquo;ll go to <em>Edit→Patch program→Assemble&hellip;</em></p>
<a class="lightgallery" href="/posts/flare-on7-wednesday/images/image.png" title="/posts/flare-on7-wednesday/images/image.png" data-thumbnail="/posts/flare-on7-wednesday/images/image.png">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="images/image.png"
            data-srcset="/posts/flare-on7-wednesday/images/image.png, images/image.png 1.5x, /posts/flare-on7-wednesday/images/image.png 2x"
            data-sizes="auto"
            alt="/posts/flare-on7-wednesday/images/image.png" />
    </a>
<div class="highlight"><pre class="chroma"><code class="language-asm" data-lang="asm"><span class="c">; Before the patch
</span><span class="c"></span><span class="nl">.text:</span><span class="err">00433</span><span class="nf">FAD</span>                 <span class="no">cmp</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">eax</span><span class="p">],</span> <span class="mi">128</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">00433</span><span class="nf">FB3</span>                 <span class="no">jnz</span>     <span class="no">loc_433D3A</span>

<span class="c">; After the patch
</span><span class="c"></span><span class="nl">.text:</span><span class="err">00433</span><span class="nf">FAD</span>                 <span class="no">cmp</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">eax</span><span class="p">],</span> <span class="mi">2</span>
<span class="nl">.text:</span><span class="err">00433</span><span class="nf">FB0</span>                 <span class="no">nop</span>
<span class="nl">.text:</span><span class="err">00433</span><span class="nf">FB1</span>                 <span class="no">nop</span>
<span class="nl">.text:</span><span class="err">00433</span><span class="nf">FB2</span>                 <span class="no">nop</span>
<span class="nl">.text:</span><span class="err">00433</span><span class="nf">FB3</span>                 <span class="no">jnz</span>     <span class="no">loc_433D3A</span>
</code></pre></div><p>Next, we will <em>Edit→Patch program→Apply patches to input file&hellip;</em> and we&rsquo;ll run our new game and pass 2 obstacles.</p>
<a class="lightgallery" href="/posts/flare-on7-wednesday/images/image_1.png" title="/posts/flare-on7-wednesday/images/image_1.png" data-thumbnail="/posts/flare-on7-wednesday/images/image_1.png">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="images/image_1.png"
            data-srcset="/posts/flare-on7-wednesday/images/image_1.png, images/image_1.png 1.5x, /posts/flare-on7-wednesday/images/image_1.png 2x"
            data-sizes="auto"
            alt="/posts/flare-on7-wednesday/images/image_1.png" />
    </a>
<p>We won! But hang on, where&rsquo;s our flag? This probably means that the flag is somehow affected by the score, or obstacles avoided during the game, so we need to try a different method.</p>
<p>Our strategy will now be trying to change the condition that is responsible to tell the game if we passed an obstacle or not. The way to locate the code that does it can be by simply debugging the game or by checking the function names since in this case, we have the symbols. We find <code>checkCollisions__P9bTKWszU9b7sTpYI5ZXt5Ug</code> which seems like it checks every collision that dude has with an obstacle. Now we&rsquo;ll try to locate the condition after which we add 1 to our score or lose the game. <code>checkCollisions__P9bTKWszU9b7sTpYI5ZXt5Ug</code> doesn&rsquo;t seem to contain what we&rsquo;re after, but it does call another function that sounds related - <code>onCollide__BN6X9bI9aXYgG1H4BavWOusg</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="kr">__fastcall</span> <span class="nf">onCollide__BN6X9bI9aXYgG1H4BavWOusg</span><span class="p">(</span><span class="kt">int</span> <span class="o">**</span><span class="n">a1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">v4</span><span class="p">;</span> <span class="c1">// eax
</span><span class="c1"></span>
  <span class="n">chckNilDisp</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">a1</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v4</span> <span class="o">=</span> <span class="o">*</span><span class="n">a1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="n">a1</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">NTI__Izz1yqaplqIXEoEFpusDCA_</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">isObj</span><span class="p">(</span><span class="o">&amp;</span><span class="n">NTI__Izz1yqaplqIXEoEFpusDCA_</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">NTI__Izz1yqaplqIXEoEFpusDCA_</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">raiseObjectConversionError</span><span class="p">();</span>
      <span class="o">**</span><span class="n">onCollide__9byAjE9cSmbSbow3F9cTFQfLg</span><span class="o">**</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">NTI__zAmpQ4W10DAkJqNC4t2weQ_</span>
           <span class="o">||</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">v4</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">NTI__zAmpQ4W10DAkJqNC4t2weQ_</span>
           <span class="o">||</span> <span class="n">v4</span> <span class="o">!=</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">Nim_OfCheck_CACHE20</span>
           <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">v4</span> <span class="o">==</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">dword_443FAC</span>
            <span class="o">||</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">isObjSlowPath__H8B7g6iFRPI5Em52KFoD6w</span><span class="p">(</span>
                                  <span class="n">v4</span><span class="p">,</span>
                                  <span class="o">&amp;</span><span class="n">NTI__zAmpQ4W10DAkJqNC4t2weQ_</span><span class="p">,</span>
                                  <span class="o">&amp;</span><span class="n">Nim_OfCheck_CACHE20</span><span class="p">))</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">onCollide__LM9b9b09cstNz9cvDN3XPcQqVg</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Then we&rsquo;ll continue our analysis of the collision functions with <code>onCollide__9byAjE9cSmbSbow3F9cTFQfLg</code>, which does seem to alter the score.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="kr">__fastcall</span> <span class="nf">onCollide__9byAjE9cSmbSbow3F9cTFQfLg</span><span class="p">(</span><span class="kt">int</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">v2</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">**</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">20</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v2</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v22</span> <span class="o">=</span> <span class="o">*</span><span class="n">v2</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">*</span><span class="n">v2</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">v4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">v5</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="n">v6</span> <span class="o">=</span> <span class="n">v2</span><span class="p">[</span><span class="n">v4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">v6</span> <span class="p">)</span>
        <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">v6</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="p">(</span><span class="n">_WORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">v6</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span> <span class="o">==</span> <span class="mi">24932</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">v6</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">121</span> <span class="p">)</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">v7</span> <span class="o">=</span> <span class="n">__OFADD__</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">v5</span><span class="o">++</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">v7</span> <span class="p">)</span>
          <span class="p">((</span><span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">void</span><span class="p">))</span><span class="n">raiseOverflow</span><span class="p">)();</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">v22</span> <span class="o">==</span> <span class="o">++</span><span class="n">v4</span> <span class="p">)</span>
          <span class="k">goto</span> <span class="n">LABEL_12</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">v22</span> <span class="o">&lt;=</span> <span class="n">v4</span> <span class="p">)</span>
          <span class="n">raiseIndexError2</span><span class="p">(</span><span class="n">v4</span><span class="p">,</span> <span class="o">*</span><span class="n">v2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">v5</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="n">v13</span> <span class="o">=</span> <span class="n">sfxData__L0NEb9bbVaCJg09cSf9auviJQ</span><span class="p">;</span>
        <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">a1</span> <span class="o">+</span> <span class="mi">249</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">v14</span> <span class="o">=</span> <span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">X5BX5D___m13cHDTNyHJWI0nfsypQew</span><span class="p">(</span><span class="n">v13</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">TM__E4euemHcWzC1bcQ69azK2pw_8</span><span class="p">);</span>
        <span class="n">play__ekc9cEXgy7z9cRAqIYID39ccg</span><span class="p">(</span><span class="o">*</span><span class="n">v14</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="p">}</span>
<span class="nl">LABEL_12</span><span class="p">:</span>
      <span class="n">v8</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">**</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">20</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">v8</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="n">v9</span> <span class="o">=</span> <span class="o">*</span><span class="n">v8</span><span class="p">;</span>
        <span class="n">v23</span> <span class="o">=</span> <span class="n">v8</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">*</span><span class="n">v8</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="p">{</span>
          <span class="n">v10</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="n">v11</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
          <span class="p">{</span>
            <span class="n">v12</span> <span class="o">=</span> <span class="n">v23</span><span class="p">[</span><span class="n">v10</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">v12</span> <span class="p">)</span>
            <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">v12</span> <span class="o">==</span> <span class="mi">5</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">v12</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span> <span class="o">==</span> <span class="err">&#39;</span><span class="n">cehc</span><span class="err">&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">v12</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="o">==</span> <span class="sc">&#39;k&#39;</span> <span class="p">)</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">v7</span> <span class="o">=</span> <span class="n">__OFADD__</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">v11</span><span class="o">++</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">v7</span> <span class="p">)</span>
              <span class="p">((</span><span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">void</span><span class="p">))</span><span class="n">raiseOverflow</span><span class="p">)();</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">v9</span> <span class="o">==</span> <span class="o">++</span><span class="n">v10</span> <span class="p">)</span>
              <span class="k">return</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">v9</span> <span class="o">&lt;=</span> <span class="n">v10</span> <span class="p">)</span>
              <span class="n">raiseIndexError2</span><span class="p">(</span><span class="n">v10</span><span class="p">,</span> <span class="n">v9</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">v11</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">)</span>
          <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">isObj</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">a2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">NTI__bc9cIRpcNby7Dj3TH0kx9cWA_</span><span class="p">)</span> <span class="p">)</span>
              <span class="n">raiseObjectConversionError</span><span class="p">();</span>
            <span class="n">v15</span> <span class="o">=</span> <span class="n">score__h34o6jaI3AO6iOQqLKaqhw</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">__OFADD__</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">score__h34o6jaI3AO6iOQqLKaqhw</span><span class="p">)</span> <span class="p">)</span>
              <span class="p">((</span><span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">void</span><span class="p">))</span><span class="n">raiseOverflow</span><span class="p">)();</span>
            <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">24</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">score__h34o6jaI3AO6iOQqLKaqhw</span> <span class="o">=</span> <span class="n">v15</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">isObj</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">a2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">NTI__bc9cIRpcNby7Dj3TH0kx9cWA_</span><span class="p">)</span> <span class="p">)</span>
              <span class="n">raiseObjectConversionError</span><span class="p">();</span>
            <span class="n">v16</span> <span class="o">=</span> <span class="n">incrSeqV3</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">a1</span> <span class="o">+</span> <span class="mi">252</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">NTI__pxbIse2JUQkJU0n9blV9bY5g_</span><span class="p">);</span>
            <span class="n">v17</span> <span class="o">=</span> <span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">v16</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">v16</span> <span class="p">)</span>
              <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">v16</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+=</span> <span class="mi">8</span><span class="p">;</span>
            <span class="n">v18</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">a1</span> <span class="o">+</span> <span class="mi">252</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">v18</span> <span class="p">)</span>
            <span class="p">{</span>
              <span class="n">v19</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">v18</span> <span class="o">-</span> <span class="mi">8</span><span class="p">);</span>
              <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">v18</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="n">v19</span> <span class="o">-</span> <span class="mi">8</span><span class="p">;</span>
              <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)(</span><span class="n">v19</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">7</span> <span class="p">)</span>
                <span class="n">addZCT__Y66tOYFjgwJ0k4aLz4bc0Q</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dword_44B54C</span><span class="p">,</span> <span class="n">v18</span> <span class="o">-</span> <span class="mi">8</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">a1</span> <span class="o">+</span> <span class="mi">252</span><span class="p">)</span> <span class="o">=</span> <span class="n">v17</span><span class="p">;</span>
            <span class="n">v20</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">v17</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">a1</span> <span class="o">+</span> <span class="mi">252</span><span class="p">)</span> <span class="o">+</span> <span class="n">v20</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">248</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>We want this line of code to always be executed.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">v15</span> <span class="o">=</span> <span class="n">score__h34o6jaI3AO6iOQqLKaqhw</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div><p>So we patch the branch before that. This is how it looks like before:</p>
<a class="lightgallery" href="/posts/flare-on7-wednesday/images/image_2.png" title="/posts/flare-on7-wednesday/images/image_2.png" data-thumbnail="/posts/flare-on7-wednesday/images/image_2.png">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="images/image_2.png"
            data-srcset="/posts/flare-on7-wednesday/images/image_2.png, images/image_2.png 1.5x, /posts/flare-on7-wednesday/images/image_2.png 2x"
            data-sizes="auto"
            alt="/posts/flare-on7-wednesday/images/image_2.png" />
    </a>
<p>And here&rsquo;s after:</p>
<a class="lightgallery" href="/posts/flare-on7-wednesday/images/image_3.png" title="/posts/flare-on7-wednesday/images/image_3.png" data-thumbnail="/posts/flare-on7-wednesday/images/image_3.png">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="images/image_3.png"
            data-srcset="/posts/flare-on7-wednesday/images/image_3.png, images/image_3.png 1.5x, /posts/flare-on7-wednesday/images/image_3.png 2x"
            data-sizes="auto"
            alt="/posts/flare-on7-wednesday/images/image_3.png" />
    </a>
<p>When we run the patched game, it looks like we still need to duck to avoid all types of obstacles. Oh well, we&rsquo;ll put something heavy to press on our down arrow key, and after a few minutes we have this:</p>
<a class="lightgallery" href="/posts/flare-on7-wednesday/images/getFlag1.gif" title="/posts/flare-on7-wednesday/images/getFlag1.gif" data-thumbnail="/posts/flare-on7-wednesday/images/getFlag1.gif">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="images/getFlag1.gif"
            data-srcset="/posts/flare-on7-wednesday/images/getFlag1.gif, images/getFlag1.gif 1.5x, /posts/flare-on7-wednesday/images/getFlag1.gif 2x"
            data-sizes="auto"
            alt="/posts/flare-on7-wednesday/images/getFlag1.gif" />
    </a>
<p>We got the flag - <code>1t_i5_wEdn3sd4y_mY_Dud3s@flare-on.com</code>!</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2020-10-23</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/flare-on/">flare-on</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/flare-on7-garbage/" class="prev" rel="prev" title="Flare-On 7 — 02 Garbage"><i class="fas fa-angle-left fa-fw"></i>Flare-On 7 — 02 Garbage</a>
            <a href="/posts/flare-on7-report/" class="next" rel="next" title="Flare-On 7 — 04 Report">Flare-On 7 — 04 Report<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.76.5">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":20},"comment":{},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-Z0NYXY577C');
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-Z0NYXY577C" async></script></body>
</html>
